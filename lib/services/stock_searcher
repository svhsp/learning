import 'package:http/http.dart' as http;
import 'dart:convert';
import 'models/stock_info.dart';
import 'dart:math';

class StockSearcher {

  Future<List<StockInfo>> fetchStocks(String query) async {
    List<StockInfo> returnValue = [];
      try{
        var url = Uri.parse(
            'https://finnhub.io/api/v1/search?q='+ query + '&token=cgu3hqpr01qu2uq5p73gcgu3hqpr01qu2uq5p740');
        var response = await http.get(url);
        Map data = jsonDecode(response.body);

        for (int i = 0; i < min(data['result'].length, 3); i++)
          {
            returnValue.add(StockInfo.Search(tickerName: data['result'][i]['symbol'], companyName: data['result'][i]['description']););
          }
      } catch (e) {
        print('http call fail');
      }
    return returnValue;
    }

  }

